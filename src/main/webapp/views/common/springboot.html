<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hibernate å‡ç´š Spring Boot å®Œæ•´æŒ‡å—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .slide {
            background: white;
            margin: 30px 0;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            page-break-after: always;
        }

        .title-slide {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 40px;
        }

        .title-slide h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title-slide p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h2 {
            color: #764ba2;
            font-size: 1.8em;
            margin: 30px 0 15px 0;
            display: flex;
            align-items: center;
        }

        h2::before {
            content: "â–¶";
            color: #667eea;
            margin-right: 10px;
            font-size: 0.8em;
        }

        h3 {
            color: #555;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
            background: #f8f9fa;
            padding: 10px 15px;
            border-left: 4px solid #667eea;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table tr:hover {
            background: #e3f2fd;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }

        .code-block::before {
            content: attr(data-language);
            position: absolute;
            top: 5px;
            right: 15px;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .highlight h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .pros,
        .cons {
            padding: 20px;
            border-radius: 8px;
        }

        .pros {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-left: 5px solid #28a745;
        }

        .cons {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-left: 5px solid #dc3545;
        }

        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }

        ul li {
            margin: 8px 0;
            padding-left: 10px;
            position: relative;
        }

        ul li::before {
            content: "âœ“";
            color: #667eea;
            font-weight: bold;
            position: absolute;
            left: -15px;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning::before {
            content: "âš ï¸ ";
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .slide {
                padding: 20px;
                margin: 15px 0;
            }

            h1 {
                font-size: 2em;
            }

            .pros-cons {
                grid-template-columns: 1fr;
            }

            .comparison-table {
                font-size: 0.9em;
            }
        }

        @media print {
            body {
                background: white;
            }

            .slide {
                margin: 0;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- æ¨™é¡Œé  -->
        <div class="slide title-slide">
            <h1>ğŸš€ Hibernate å‡ç´š Spring Boot</h1>
            <p>å®Œæ•´é·ç§»æŒ‡å—èˆ‡å¯¦æˆ°ç¯„ä¾‹</p>
            <p style="margin-top: 30px; font-size: 1.1em;">å¾å‚³çµ±æ¶æ§‹åˆ°ç¾ä»£åŒ–é–‹ç™¼</p>
        </div>

        <!-- æ¦‚è¿° -->
        <div class="slide">
            <h1>ğŸ“‹ é·ç§»æ¦‚è¿°</h1>

            <div class="highlight">
                <h4>ğŸ¯ é·ç§»ç›®æ¨™</h4>
                <p>å°‡å‚³çµ±çš„ Hibernate + Servlet æ¶æ§‹å‡ç´šç‚ºç¾ä»£åŒ–çš„ Spring Boot + JPA æ¶æ§‹</p>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>Hibernate + Servlet</th>
                        <th>Spring Boot + JPA</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Entity</strong></td>
                        <td>ç´” Hibernate è¨»è§£</td>
                        <td>JPA è¨»è§£ï¼ˆç›¸å®¹ Hibernateï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>è³‡æ–™å­˜å–</strong></td>
                        <td>æ‰‹å¯« DAO é¡åˆ¥</td>
                        <td>Spring Data Repository</td>
                    </tr>
                    <tr>
                        <td><strong>æ§åˆ¶å™¨</strong></td>
                        <td>Servlet é¡åˆ¥</td>
                        <td>Spring Controller</td>
                    </tr>
                    <tr>
                        <td><strong>è¨­å®šæª”</strong></td>
                        <td>hibernate.cfg.xml</td>
                        <td>application.properties</td>
                    </tr>
                    <tr>
                        <td><strong>äº‹å‹™ç®¡ç†</strong></td>
                        <td>æ‰‹å‹•ç®¡ç†</td>
                        <td>è‡ªå‹•ç®¡ç† (@Transactional)</td>
                    </tr>
                    <tr>
                        <td><strong>ä¾è³´æ³¨å…¥</strong></td>
                        <td>æ‰‹å‹•å»ºç«‹ç‰©ä»¶</td>
                        <td>è‡ªå‹•æ³¨å…¥ (@Autowired)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- å°ˆæ¡ˆè¨­å®š -->
        <div class="slide">
            <h1>ğŸ“¦ 1. å°ˆæ¡ˆè¨­å®šè½‰æ›</h1>

            <h2>Maven ä¾è³´æ›´æ–°</h2>

            <h3>èˆŠç‰ˆ pom.xml (Hibernate)</h3>
            <div class="code-block" data-language="XML">
                <pre>&lt;dependencies&gt;
    &lt;!-- Hibernate --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
        &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
        &lt;version&gt;5.6.15.Final&lt;/version&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Servlet API --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;
        &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;
        &lt;version&gt;5.0.0&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
            </div>

            <h3>æ–°ç‰ˆ pom.xml (Spring Boot)</h3>
            <div class="code-block" data-language="XML">
                <pre>&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;3.2.0&lt;/version&gt;
&lt;/parent&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
            </div>

            <h2>è¨­å®šæª”è½‰æ›</h2>

            <h3>èˆŠç‰ˆ hibernate.cfg.xml</h3>
            <div class="code-block" data-language="XML">
                <pre>&lt;hibernate-configuration&gt;
    &lt;session-factory&gt;
        &lt;property name="connection.driver_class"&gt;com.mysql.cj.jdbc.Driver&lt;/property&gt;
        &lt;property name="connection.url"&gt;jdbc:mysql://localhost:3306/eams&lt;/property&gt;
        &lt;property name="connection.username"&gt;root&lt;/property&gt;
        &lt;property name="connection.password"&gt;password&lt;/property&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQL8Dialect&lt;/property&gt;
        &lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;
        &lt;property name="show_sql"&gt;true&lt;/property&gt;
    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;</pre>
            </div>

            <h3>æ–°ç‰ˆ application.properties</h3>
            <div class="code-block" data-language="Properties">
                <pre># è³‡æ–™åº«é€£ç·šè¨­å®š
spring.datasource.drivername=com.microsoft.sqlserver.jdbc.SQLServerDriver
spring.datasource.url=jdbc:sqlserver://localhost:1433;databaseName=test;encrypt=true;trustServerCertificate=true
spring.datasource.username=chris
spring.datasource.password=zxcbbn5869

# JPA è¨­å®š
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect
spring.jpa.properties.hibernate.format_sql=true

# ä¼ºæœå™¨è¨­å®š
server.port=8080
server.servlet.context-path=/eams</pre>
            </div>
        </div>

        <!-- Entity è½‰æ› -->
        <div class="slide">
            <h1>ğŸ—ï¸ 2. Entity è½‰æ›</h1>

            <h2>ä¸»è¦è®ŠåŒ–</h2>
            <div class="highlight">
                <h4>ğŸ”„ Package è®Šæ›´</h4>
                <p><code>javax.persistence.*</code> â†’ <code>jakarta.persistence.*</code></p>
            </div>

            <h3>èˆŠç‰ˆ Hibernate Entity</h3>
            <div class="code-block" data-language="Java">
                <pre>import javax.persistence.*;

@Entity
@Table(name = "student")
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    
    @Column(name = "name")
    private String name;
    
    // getter, setter...
}</pre>
            </div>

            <h3>æ–°ç‰ˆ JPA Entity</h3>
            <div class="code-block" data-language="Java">
                <pre>import jakarta.persistence.*;
import java.time.LocalDateTime;

@Entity
@Table(name = "student")
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    
    @Column(name = "name")
    private String name;
    
    @Column(name = "created_at")
    private LocalDateTime createdAt;
    
    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
    }
    
    // getter, setter...
}</pre>
            </div>
        </div>

        <!-- DAO è½‰ Repository -->
        <div class="slide">
            <h1>ğŸ—„ï¸ 3. DAO â†’ Repository è½‰æ›</h1>

            <h3>èˆŠç‰ˆ StudentDAOï¼ˆæ‰‹å¯« CRUDï¼‰</h3>
            <div class="code-block" data-language="Java">
                <pre>public class StudentDAO {
    private SessionFactory sessionFactory;
    
    public Student save(Student student) {
        Session session = sessionFactory.openSession();
        Transaction transaction = null;
        try {
            transaction = session.beginTransaction();
            session.save(student);
            transaction.commit();
            return student;
        } catch (Exception e) {
            if (transaction != null) transaction.rollback();
            throw e;
        } finally {
            session.close();
        }
    }
    
    public Student findById(Integer id) {
        Session session = sessionFactory.openSession();
        try {
            return session.get(Student.class, id);
        } finally {
            session.close();
        }
    }
}</pre>
            </div>

            <h3>æ–°ç‰ˆ Spring Data Repository</h3>
            <div class="code-block" data-language="Java">
                <pre>@Repository
public interface StudentRepository extends JpaRepository&lt;Student, Integer&gt; {
    
    // åŸºæœ¬ CRUD æ–¹æ³•å·²å…§å»ºï¼š
    // save(), findById(), findAll(), deleteById()
    
    // è‡ªè¨‚æŸ¥è©¢æ–¹æ³•
    Optional&lt;Student&gt; findByEmail(String email);
    
    List&lt;Student&gt; findByNameContaining(String name);
    
    @Query("SELECT s FROM Student s WHERE s.name = :name")
    Optional&lt;Student&gt; findByName(@Param("name") String name);
    
    boolean existsByEmail(String email);
}</pre>
            </div>
        </div>

        <!-- Servlet è½‰ Controller -->
        <div class="slide">
            <h1>ğŸ® 4. Servlet â†’ Controller è½‰æ›</h1>

            <h3>èˆŠç‰ˆ CourseServletï¼ˆå‚³çµ±æ‰‹å‹•è™•ç†ï¼‰</h3>
            <div class="code-block" data-language="Java">
                <pre>@WebServlet("/CourseServlet")
public class CourseServlet extends HttpServlet {
    private CourseService courseService = new CourseService(); // æ‰‹å‹•å»ºç«‹
    
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        List&lt;Course&gt; courses = courseService.getAllCourse();
        
        resp.setContentType("application/json");
        resp.setCharacterEncoding("UTF-8");
        
        // ğŸ˜° æ‰‹å‹•å»ºæ§‹ JSON å­—ä¸²ï¼ˆå®¹æ˜“å‡ºéŒ¯ã€é›£ç¶­è­·ï¼‰
        StringBuilder json = new StringBuilder("[");
        for (int i = 0; i &lt; courses.size(); i++) {
            Course c = courses.get(i);
            json.append("{")
                .append("\"id\":").append(c.getId()).append(",")
                .append("\"name\":\"").append(escapeJson(c.getName())).append("\",")
                .append("\"startDate\":\"").append(c.getStartDate()).append("\"")
                .append("}");
            if (i &lt; courses.size() - 1) json.append(",");
        }
        json.append("]");
        
        resp.getWriter().write(json.toString());
    }
}</pre>
            </div>

            <h3>æ–°ç‰ˆ Spring Controllerï¼ˆè‡ªå‹• JSON è™•ç†ï¼‰</h3>
            <div class="code-block" data-language="Java">
                <pre>@RestController
@RequestMapping("/api/course")
public class CourseApiController {
    
    @Autowired  // ğŸ˜ è‡ªå‹•æ³¨å…¥ï¼Œä¸éœ€æ‰‹å‹•å»ºç«‹
    private CourseService courseService;
    
    // âœ¨ æŸ¥è©¢æ‰€æœ‰èª²ç¨‹ - Map åŒ…è£é¿å…åºåˆ—åŒ–å•é¡Œ
    @GetMapping("/all")
    public List&lt;Map&lt;String, Object&gt;&gt; getAllCourse() {
        List&lt;Course&gt; all = courseService.getAllCourse();
        List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;&gt;();
        
        for (Course c : all) {
            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
            map.put("id", c.getId());
            map.put("name", c.getName());
            map.put("type", c.getType());
            map.put("description", c.getDescription());
            map.put("maxCapacity", c.getMaxCapacity());
            map.put("minCapacity", c.getMinCapacity());
            map.put("fee", c.getFee());
            map.put("startDate", c.getStartDate());  // LocalDate è‡ªå‹•è½‰æ›
            map.put("endDate", c.getEndDate());
            map.put("status", c.getStatus());
            
            list.add(map);
        }
        return list;  // ğŸ˜ Spring è‡ªå‹•è½‰æ›ç‚º JSON
    }
}</pre>
            </div>
        </div>

        <!-- Map åŒ…è£æŠ€å·§è©³è§£ -->
        <div class="slide">
            <h1>ğŸ—‚ï¸ Map åŒ…è£æŠ€å·§è©³è§£</h1>

            <div class="highlight">
                <h4>ğŸ¯ ç‚ºä»€éº¼è¦ç”¨ Map åŒ…è£ï¼Ÿ</h4>
                <p>ç›´æ¥å›å‚³ Entity æœƒé‡åˆ° JSON åºåˆ—åŒ–å•é¡Œï¼Œç‰¹åˆ¥æ˜¯åƒ Course é€™æ¨£çš„è¤‡é›œ JPA é—œè¯å¯¦é«”</p>
            </div>

            <h2>âŒ ç›´æ¥å›å‚³ Entity çš„å•é¡Œ</h2>
            <div class="code-block" data-language="Java">
                <pre>// ğŸš« å±éšªçš„å¯«æ³• - ç›´æ¥å›å‚³è¤‡é›œ Entity
@GetMapping("/all")
public List&lt;Course&gt; getAllCourse() {
    return courseService.getAllCourse(); // æœƒå‡ºç¾ä»¥ä¸‹å•é¡Œï¼š
}

/* ğŸ’¥ å¯èƒ½çš„éŒ¯èª¤ï¼š
 * 1. ç„¡é™éè¿´ï¼šCourse â†’ CourseEnroll â†’ Student â†’ CourseEnroll...
 * 2. LazyInitializationExceptionï¼šå»¶é²è¼‰å…¥ä¾‹å¤–
 * 3. LocalDate åºåˆ—åŒ–å•é¡Œ
 * 4. 415 Unsupported Media Typeï¼šJackson ç„¡æ³•è™•ç†è¤‡é›œé—œè¯
 * 5. æ•æ„Ÿè³‡æ–™æ´©éœ²ï¼šå¯èƒ½åŒ…å«ä¸è©²æš´éœ²çš„æ¬„ä½
 */</pre>
            </div>

            <h2>âœ… å¯¦éš›ç¨‹å¼ç¢¼ï¼šæ–°å¢/æ›´æ–°èª²ç¨‹</h2>
            <div class="code-block" data-language="Java">
                <pre>// courseæ–°å¢è·Ÿæ›´æ–°åŒæ™‚è™•ç†
@PostMapping("/add")
@ResponseBody
public ResponseEntity&lt;String&gt; addCourse(@RequestBody Map&lt;String, Object&gt; courseData) {
    System.out.println("æ”¶åˆ° API è«‹æ±‚ï¼š" + courseData);
    
    try {
        Course course = new Course();
        
        // æ‰‹å‹•è¨­å®šå„å€‹æ¬„ä½ï¼Œé¿å… Jackson è½‰æ›å•é¡Œ
        if (courseData.get("id") != null) {
            course.setId((Integer) courseData.get("id"));  // æœ‰ ID = æ›´æ–°
        }
        course.setName((String) courseData.get("name"));
        course.setType((String) courseData.get("type"));
        course.setDescription((String) courseData.get("description"));
        course.setMaxCapacity((Integer) courseData.get("maxCapacity"));
        course.setMinCapacity((Integer) courseData.get("minCapacity"));
        course.setFee((Integer) courseData.get("fee"));
        course.setStatus((String) courseData.get("status"));
        course.setRemark((String) courseData.get("remark"));
        
        // æ‰‹å‹•è™•ç†æ—¥æœŸè½‰æ›
        String startDateStr = (String) courseData.get("startDate");
        if (startDateStr != null && !startDateStr.trim().isEmpty()) {
            course.setStartDate(LocalDate.parse(startDateStr));
        }
        
        String endDateStr = (String) courseData.get("endDate");
        if (endDateStr != null && !endDateStr.trim().isEmpty()) {
            course.setEndDate(LocalDate.parse(endDateStr));
        }
        
        courseService.saveCourse(course);
        return ResponseEntity.ok("æˆåŠŸæ–°å¢ï¼š" + course.getName());
        
    } catch (Exception e) {
        System.err.println("æ–°å¢å¤±æ•—ï¼š" + e.getMessage());
        return ResponseEntity.badRequest().body("æ–°å¢å¤±æ•—ï¼š" + e.getMessage());
    }
}</pre>
            </div>
        </div>

        <!-- å‰å¾Œç«¯å®Œæ•´é…åˆç¯„ä¾‹ -->
        <div class="slide">
            <h1>ğŸ¤ å‰å¾Œç«¯å®Œæ•´é…åˆç¯„ä¾‹</h1>

            <h2>ğŸ’» å‰ç«¯ JavaScriptï¼ˆèª²ç¨‹æ–°å¢è¡¨å–®ï¼‰</h2>
            <div class="code-block" data-language="JavaScript">
                <pre>// å„²å­˜èª²ç¨‹è³‡æ–™
function saveCourse(event) {
    event.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­é€å‡ºè¡Œç‚º

    // ğŸ“ æ”¶é›†è¡¨å–®è³‡æ–™
    const id = document.getElementById('courseIdShow').value;
    const name = document.getElementById('courseName').value;
    const type = document.getElementById('courseType').value;
    const maxCapacity = document.getElementById('maxCapacity').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    // ğŸ¯ ç¢ºä¿è³‡æ–™å‹æ…‹æ­£ç¢ºåŒ¹é…å¾Œç«¯
    const course = {
        id: id && id.trim() !== '' ? parseInt(id) : null,          // æœ‰ ID = æ›´æ–°
        name: name || '',
        type: type || '',
        maxCapacity: maxCapacity && maxCapacity.trim() !== '' ? parseInt(maxCapacity) : null,
        startDate: startDate && startDate.trim() !== '' ? startDate : null,    // "2025-07-17"
        endDate: endDate && endDate.trim() !== '' ? endDate : null,
        status: status || 'active'
    };

    // âœ… å‰ç«¯é©—è­‰
    if (!course.name || !course.type || !course.maxCapacity || !course.startDate || !course.endDate) {
        Swal.fire({
            icon: 'warning',
            title: 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½',
            confirmButtonText: 'ç¢ºå®š'
        });
        return;
    }

    // ğŸš€ ç™¼é€åˆ°å¾Œç«¯
    fetch('${pageContext.request.contextPath}/api/course/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json; charset=UTF-8',
            'Accept': 'application/json'
        },
        body: JSON.stringify(course)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();
    })
    .then(msg => {
        Swal.fire({
            icon: 'success',
            title: msg || 'æ–°å¢æˆåŠŸ',
            confirmButtonText: 'ç¢ºå®š'
        }).then(() => {
            hideCourseForm();    // éš±è—è¡¨å–®
            loadCourseList();    // é‡æ–°è¼‰å…¥åˆ—è¡¨
        });
    })
    .catch(error => {
        Swal.fire({
            icon: 'error',
            title: 'æ–°å¢å¤±æ•—',
            text: error.message,
            confirmButtonText: 'ç¢ºå®š'
        });
    });
}</pre>
            </div>

            <div class="highlight">
                <h4>ğŸ¯ å‰å¾Œç«¯é…åˆé‡é»</h4>
                <ul>
                    <li><strong>è³‡æ–™å‹æ…‹åŒ¹é…ï¼š</strong>å‰ç«¯ parseInt() å°æ‡‰å¾Œç«¯ Integer</li>
                    <li><strong>æ—¥æœŸæ ¼å¼ï¼š</strong>HTML date input â†’ "2025-07-17" â†’ LocalDate.parse()</li>
                    <li><strong>null å€¼è™•ç†ï¼š</strong>å‰ç«¯ç©ºå€¼ â†’ nullï¼Œå¾Œç«¯åˆ¤æ–· null</li>
                    <li><strong>æ–°å¢/æ›´æ–°é‚è¼¯ï¼š</strong>å‰ç«¯æœ‰ ID â†’ å¾Œç«¯åˆ¤æ–·æ›´æ–°</li>
                </ul>
            </div>
        </div>

        <!-- Session è™•ç†èˆ‡é—œè¯å¯¦é«”æ“ä½œ -->
        <div class="slide">
            <h1>ğŸ” Session è™•ç†èˆ‡é—œè¯å¯¦é«”æ“ä½œ</h1>

            <h3>èˆŠç‰ˆ EnrollCourseServlet</h3>
            <div class="code-block" data-language="Java">
                <pre>@WebServlet("/EnrollCourseServlet")
public class EnrollCourseServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) {
        // ğŸ˜° æ‰‹å‹•å»ºç«‹ Service ç‰©ä»¶
        CourseEnrollService service = new CourseEnrollService();
        StudentService studentService = new StudentService();
        CourseService courseService = new CourseService();
        
        // ğŸ˜° æ‰‹å‹•å–å¾— Session è³‡æ–™
        Integer studentId = (Integer) req.getSession().getAttribute("studentId");
        String courseIdStr = req.getParameter("courseId");
        
        int courseId = Integer.parseInt(courseIdStr);
        
        // ğŸ˜° æ‰‹å‹•æŸ¥è©¢é—œè¯å¯¦é«”
        Student student = studentService.getStudentById(studentId);
        Course course = courseService.getCourseById(courseId);
        
        CourseEnroll courseEnroll = new CourseEnroll();
        courseEnroll.setStudent(student);
        courseEnroll.setCourse(course);
        courseEnroll.setEnrollDate(LocalDate.now());
        courseEnroll.setStatus("enrolled");
        
        boolean success = service.addCourseEnroll(courseEnroll);
    }
}</pre>
            </div>

            <h3>æ–°ç‰ˆ Spring Controller</h3>
            <div class="code-block" data-language="Java">
                <pre>@RestController
@RequestMapping("/api/course")
public class CourseEnrollController {
    
    // ğŸ˜ è‡ªå‹•æ³¨å…¥ï¼Œä¸éœ€æ‰‹å‹•å»ºç«‹
    @Autowired
    private CourseEnrollService courseEnrollService;
    @Autowired
    private StudentService studentService;
    @Autowired
    private CourseService courseService;
    
    // æ–°å¢å ±å
    @PostMapping("/enroll/add")
    @ResponseBody
    public ResponseEntity&lt;String&gt; addCourseEnroll(
            @RequestBody Map&lt;String, Object&gt; courseEnrollData,
            HttpSession session) {  // ğŸ˜ Spring è‡ªå‹•æ³¨å…¥ Session
        
        try {
            CourseEnroll courseEnroll = new CourseEnroll();
            
            // ğŸ˜ ç°¡æ½”çš„ Session è³‡æ–™å–å¾—
            Integer studentId = (Integer) session.getAttribute("studentId");
            
            // ğŸ˜ æ¸…æ¥šçš„é—œè¯å¯¦é«”è™•ç†
            Student student = studentService.getStudentById(studentId);
            Course course = courseService.getCourseById((Integer) courseEnrollData.get("courseId"));
            
            courseEnroll.setStudent(student);
            courseEnroll.setCourse(course);
            courseEnroll.setEnrollDate(LocalDate.now());
            courseEnroll.setStatus("enrolled");
            
            courseEnrollService.saveCourseEnroll(courseEnroll);
            return ResponseEntity.ok("æˆåŠŸå ±åèª²ç¨‹ï¼š" + course.getName());
            
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("å ±åå¤±æ•—ï¼š" + e.getMessage());
        }
    }
}</pre>
            </div>
        </div>

        <!-- @JsonManagedReference/@JsonBackReference è©³è§£ -->
        <div class="slide">
            <h1>ğŸ”„ @JsonManagedReference/@JsonBackReference è©³è§£</h1>

            <div class="highlight">
                <h4>âš ï¸ ç‚ºä»€éº¼å¿…é ˆæˆå°ä½¿ç”¨ï¼Ÿ</h4>
                <p>æ²’æœ‰æ­£ç¢ºä½¿ç”¨é€™äº›è¨»è§£ï¼Œæœƒå°è‡´ <strong>JSON ç„¡é™å¾ªç’°</strong>ã€<strong>JPA é—œè¯ç®¡ç†å•é¡Œ</strong>ã€<strong>è³‡æ–™åˆªé™¤/æ›´æ–°å¤±æ•—</strong>ï¼</p>
            </div>

            <h2>âŒ æ²’æœ‰ä½¿ç”¨è¨»è§£çš„å•é¡Œ</h2>
            <div class="code-block" data-language="Java">
                <pre>// ğŸš« å±éšªï¼æ²’æœ‰ JSON è¨»è§£çš„é›™å‘é—œè¯
@Entity
public class Course {
    @OneToMany(mappedBy = "course", fetch = FetchType.EAGER)
    private List&lt;CourseEnroll&gt; courseEnroll = new LinkedList&lt;&gt;();  // æ²’æœ‰è¨»è§£
}

@Entity  
public class CourseEnroll {
    @ManyToOne
    @JoinColumn(name = "course_id")
    private Course course;  // æ²’æœ‰è¨»è§£
}

/* ğŸ”¥ æœƒå°è‡´çš„å•é¡Œï¼š
 * 1. JSON åºåˆ—åŒ–ç„¡é™å¾ªç’°ï¼šCourse â†’ CourseEnroll â†’ Course â†’ CourseEnroll...
 * 2. Jackson åºåˆ—åŒ–å¤±æ•—ï¼š"Infinite recursion (StackOverflowError)"
 * 3. JPA é—œè¯ç®¡ç†æ··äº‚ï¼šç´šè¯åˆªé™¤å¤±æ•—ã€æ›´æ–°é—œè¯å¤±æ•—ã€å­¤å…’è¨˜éŒ„ç”¢ç”Ÿ
 */</pre>
            </div>

            <h2>âœ… æ­£ç¢ºçš„æˆå°ä½¿ç”¨</h2>
            <div class="code-block" data-language="Java">
                <pre>@Entity
@Table(name = "course")
public class Course {
    // âœ… @JsonManagedReferenceï¼šä¸»æ§ç«¯ï¼ˆè¢«åºåˆ—åŒ–ï¼‰
    @OneToMany(mappedBy = "course", fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @JsonManagedReference("course-enroll")  // æŒ‡å®šåç¨±é¿å…æ··æ·†
    private List&lt;CourseEnroll&gt; courseEnroll = new LinkedList&lt;&gt;();
    
    @OneToMany(mappedBy = "course", fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @JsonManagedReference("course-schedule")
    private List&lt;CourseSchedule&gt; courseSchedule = new LinkedList&lt;&gt;();
}

@Entity
@Table(name = "course_enroll")
public class CourseEnroll {
    // âœ… @JsonBackReferenceï¼šè¢«æ§ç«¯ï¼ˆä¸è¢«åºåˆ—åŒ–ï¼Œé¿å…å¾ªç’°ï¼‰
    @ManyToOne
    @JoinColumn(name = "course_id")
    @JsonBackReference("course-enroll")  // å¿…é ˆèˆ‡å°æ‡‰çš„ @JsonManagedReference åç¨±ç›¸åŒ
    private Course course;
    
    @ManyToOne
    @JoinColumn(name = "student_id")
    @JsonBackReference("student-enroll")
    private Student student;
}</pre>
            </div>

            <div class="warning">
                <strong>ğŸ’¡ æœ€ä½³å¯¦è¸å»ºè­°</strong><br>
                1. <strong>æ‰€æœ‰é›™å‘é—œè¯éƒ½è¦æˆå°ä½¿ç”¨</strong><br>
                2. <strong>ä½¿ç”¨æœ‰æ„ç¾©çš„åç¨±</strong>ï¼šå¦‚ "course-enroll", "student-enroll"<br>
                3. <strong>è¤‡é›œæƒ…æ³ç”¨ Map åŒ…è£</strong>ï¼šå®Œå…¨é¿å… Entity åºåˆ—åŒ–å•é¡Œ
            </div>
        </div>

        <!-- å¸¸è¦‹å•é¡Œèˆ‡å¯¦æˆ°è§£æ±ºæ–¹æ¡ˆ -->
        <div class="slide">
            <h1>â— å¸¸è¦‹å•é¡Œèˆ‡å¯¦æˆ°è§£æ±ºæ–¹æ¡ˆ</h1>

            <div class="warning">
                <strong>Package Import éŒ¯èª¤</strong><br>
                <strong>å•é¡Œï¼š</strong>javax.persistence æ‰¾ä¸åˆ°<br>
                <strong>è§£æ±ºï¼š</strong>Spring Boot 3.x è¦æ”¹ç”¨ jakarta.persistence
            </div>

            <div class="warning">
                <strong>415 Unsupported Media Type</strong><br>
                <strong>å•é¡Œï¼š</strong>è¤‡é›œ Entityï¼ˆå¦‚ Courseï¼‰ç„¡æ³•è‡ªå‹•ç¶å®š JSON<br>
                <strong>åŸå› ï¼š</strong>Entity æœ‰å¤ªå¤š JPA é—œè¯ã€EAGER è¼‰å…¥ã€@JsonManagedReference<br>
                <strong>è§£æ±ºï¼š</strong>æ”¹ç”¨ Map&lt;String, Object&gt; æ‰‹å‹•è™•ç†
            </div>

            <div class="warning">
                <strong>JSON åºåˆ—åŒ–ç„¡é™å¾ªç’°</strong><br>
                <strong>å•é¡Œï¼š</strong>ç›´æ¥å›å‚³ Entity å°è‡´ StackOverflowError<br>
                <strong>åŸå› ï¼š</strong>é›™å‘é—œè¯æ²’æœ‰æ­£ç¢ºä½¿ç”¨ @JsonManagedReference/@JsonBackReference<br>
                <strong>è§£æ±ºï¼š</strong>ä½¿ç”¨ Map åŒ…è£æˆ–æ­£ç¢ºè¨­å®š JSON è¨»è§£
            </div>

            <h3>å¯¦æˆ°è§£æ±ºç¯„ä¾‹ï¼šè¤‡é›œ Entity çš„è™•ç†</h3>
            <div class="code-block" data-language="Java">
                <pre>// âŒ å•é¡Œï¼šç›´æ¥ç”¨ @RequestBody Course
@PostMapping("/add")
public ResponseEntity&lt;String&gt; addCourse(@RequestBody Course course) {
    // ğŸ’¥ 415 éŒ¯èª¤ï¼šJackson ç„¡æ³•è§£æè¤‡é›œ Entity
}

// âœ… è§£æ±ºï¼šMap æ¥æ”¶ï¼Œæ‰‹å‹•è¨­å®š Entity
@PostMapping("/add") 
@ResponseBody
public ResponseEntity&lt;String&gt; addCourse(@RequestBody Map&lt;String, Object&gt; courseData) {
    try {
        Course course = new Course();
        
        // æ‰‹å‹•è¨­å®šï¼Œå®Œå…¨æ§åˆ¶
        course.setName((String) courseData.get("name"));
        course.setMaxCapacity((Integer) courseData.get("maxCapacity"));
        
        // æ‰‹å‹•è™•ç†æ—¥æœŸ
        String startDateStr = (String) courseData.get("startDate");
        if (startDateStr != null && !startDateStr.trim().isEmpty()) {
            course.setStartDate(LocalDate.parse(startDateStr));
        }
        
        courseService.saveCourse(course);
        return ResponseEntity.ok("æˆåŠŸæ–°å¢ï¼š" + course.getName());
        
    } catch (Exception e) {
        return ResponseEntity.badRequest().body("æ–°å¢å¤±æ•—ï¼š" + e.getMessage());
    }
}</pre>
            </div>
        </div>

        <!-- é·ç§»æ­¥é©Ÿ -->
        <div class="slide">
            <h1>ğŸš€ å®Œæ•´é·ç§»æ­¥é©Ÿ</h1>

            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>å»ºç«‹ Spring Boot å°ˆæ¡ˆ</h4>
                    <p>ä½¿ç”¨ Spring Initializr å»ºç«‹å°ˆæ¡ˆï¼Œé¸æ“‡ Webã€JPAã€MySQL Driver ä¾è³´</p>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <h4>é·ç§»è¨­å®šæª”</h4>
                    <p>å°‡ hibernate.cfg.xml è½‰æ›åˆ° application.properties</p>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <h4>æ›´æ–° Entity</h4>
                    <p>æ›´æ–° import packageï¼Œæ­£ç¢ºè¨­å®š @JsonManagedReference/@JsonBackReference</p>
                </div>

                <div class="step">
                    <div class="step-number">4</div>
                    <h4>å»ºç«‹ Repository</h4>
                    <p>ç‚ºæ¯å€‹ Entity å»ºç«‹ Repository interface</p>
                </div>

                <div class="step">
                    <div class="step-number">5</div>
                    <h4>æ›´æ–° Service</h4>
                    <p>åŠ å…¥ @Serviceã€@Autowiredã€@Transactional è¨»è§£</p>
                </div>

                <div class="step">
                    <div class="step-number">6</div>
                    <h4>è½‰æ› Controller</h4>
                    <p>å°‡ Servlet æ”¹å¯«ç‚º Spring Controllerï¼Œä½¿ç”¨ Map è™•ç†è¤‡é›œ Entity</p>
                </div>

                <div class="step">
                    <div class="step-number">7</div>
                    <h4>å»ºç«‹ä¸»ç¨‹å¼</h4>
                    <p>å»ºç«‹ @SpringBootApplication ä¸»é¡åˆ¥</p>
                </div>

                <div class="step">
                    <div class="step-number">8</div>
                    <h4>æ¸¬è©¦èˆ‡èª¿æ•´</h4>
                    <p>æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½ï¼Œèª¿æ•´è¨­å®šå’Œç¨‹å¼ç¢¼</p>
                </div>
            </div>
        </div>

        <!-- å¯¦æˆ°ç¶“é©—ç¸½çµ -->
        <div class="slide">
            <h1>ğŸ‰ å¯¦æˆ°ç¶“é©—ç¸½çµ</h1>

            <div class="highlight">
                <h4>ğŸ¯ æ ¸å¿ƒè½‰æ›è¦é»</h4>
                <ul>
                    <li><strong>Entityï¼š</strong>javax.persistence â†’ jakarta.persistenceï¼Œæ­£ç¢ºè¨­å®š
                        @JsonManagedReference/@JsonBackReference</li>
                    <li><strong>Controllerï¼š</strong>ç”¨ Map&lt;String, Object&gt; å–ä»£ç›´æ¥çš„ Entity è™•ç†ï¼Œé¿å… JSON åºåˆ—åŒ–å•é¡Œ</li>
                    <li><strong>Sessionï¼š</strong>HttpSession åƒæ•¸æ³¨å…¥ï¼Œæ¯” @SessionAttribute æ›´ç›´è§€</li>
                    <li><strong>é—œè¯è™•ç†ï¼š</strong>å…ˆæŸ¥è©¢å¯¦é«”å†è¨­å®šé—œè¯ï¼Œé‚è¼¯æ¸…æ¥šä¸”å®‰å…¨</li>
                    <li><strong>éŒ¯èª¤è™•ç†ï¼š</strong>ResponseEntity æä¾›çµ±ä¸€çš„ HTTP å›æ‡‰æ ¼å¼</li>
                </ul>
            </div>

            <div class="pros-cons">
                <div class="pros">
                    <h3><span class="emoji">ğŸ’¡</span>å¯¦æˆ°æœ€ä½³å¯¦è¸</h3>
                    <ul>
                        <li><strong>è¤‡é›œ Entity ç”¨ Mapï¼š</strong>é¿å… 415 éŒ¯èª¤å’Œ JSON å¾ªç’°</li>
                        <li><strong>æ‰‹å‹•è™•ç†è³‡æ–™å‹æ…‹ï¼š</strong>å‰ç«¯ parseInt å°æ‡‰å¾Œç«¯ Integer</li>
                        <li><strong>çµ±ä¸€çš„æ—¥æœŸæ ¼å¼ï¼š</strong>HTML date â†’ "2025-07-17" â†’ LocalDate</li>
                        <li><strong>å®Œæ•´çš„éŒ¯èª¤è™•ç†ï¼š</strong>HTTP ç‹€æ…‹ç¢¼ + ä½¿ç”¨è€…å‹å–„è¨Šæ¯</li>
                        <li><strong>æ–°å¢/æ›´æ–°åŒæ™‚è™•ç†ï¼š</strong>æ ¹æ“š ID æ˜¯å¦å­˜åœ¨åˆ¤æ–·æ“ä½œ</li>
                    </ul>
                </div>

                <div class="pros">
                    <h3><span class="emoji">ğŸš€</span>æ•ˆèƒ½èˆ‡ç¶­è­·</h3>
                    <ul>
                        <li><strong>é¿å… EAGER è¼‰å…¥ï¼š</strong>æ¸›å°‘ä¸å¿…è¦çš„è³‡æ–™åº«æŸ¥è©¢</li>
                        <li><strong>ç²¾ç¢ºæ§åˆ¶ API å›æ‡‰ï¼š</strong>åªå›å‚³å‰ç«¯éœ€è¦çš„æ¬„ä½</li>
                        <li><strong>å‰å¾Œç«¯è§£è€¦ï¼š</strong>Entity çµæ§‹è®ŠåŒ–ä¸å½±éŸ¿ API</li>
                        <li><strong>å‹åˆ¥å®‰å…¨ï¼š</strong>æ˜ç¢ºçš„è³‡æ–™è½‰æ›å’Œé©—è­‰</li>
                        <li><strong>å¯é‡ç”¨çš„è½‰æ›é‚è¼¯ï¼š</strong>convertToMap æ–¹æ³•</li>
                    </ul>
                </div>
            </div>

            <h2>ğŸ“Š è½‰æ›å‰å¾Œå°æ¯”ç¸½çµ</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>è½‰æ›å‰ï¼ˆServletï¼‰</th>
                        <th>è½‰æ›å¾Œï¼ˆSpring Bootï¼‰</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>JSON è™•ç†</strong></td>
                        <td>æ‰‹å‹•æ‹¼æ¥å­—ä¸²ï¼Œå®¹æ˜“å‡ºéŒ¯</td>
                        <td>Map åŒ…è£ï¼Œè‡ªå‹•åºåˆ—åŒ–</td>
                    </tr>
                    <tr>
                        <td><strong>Session è™•ç†</strong></td>
                        <td>req.getSession().getAttribute()</td>
                        <td>HttpSession session åƒæ•¸æ³¨å…¥</td>
                    </tr>
                    <tr>
                        <td><strong>ä¾è³´ç®¡ç†</strong></td>
                        <td>æ‰‹å‹• new Service()</td>
                        <td>@Autowired è‡ªå‹•æ³¨å…¥</td>
                    </tr>
                    <tr>
                        <td><strong>éŒ¯èª¤è™•ç†</strong></td>
                        <td>æ‰‹å‹•è¨­å®š HTTP ç‹€æ…‹ç¢¼</td>
                        <td>ResponseEntity çµ±ä¸€è™•ç†</td>
                    </tr>
                    <tr>
                        <td><strong>è³‡æ–™ç¶å®š</strong></td>
                        <td>req.getParameter() é€ä¸€å–å¾—</td>
                        <td>@RequestBody Map æ‰¹æ¬¡è™•ç†</td>
                    </tr>
                </tbody>
            </table>

            <div
                style="text-align: center; margin-top: 40px; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px;">
                <h2>ğŸŠ æ­å–œæŒæ¡ç¾ä»£åŒ– Java Web é–‹ç™¼ï¼</h2>
                <p><strong>å¾å‚³çµ± Servlet åˆ° Spring Bootï¼Œä½ å·²ç¶“å®Œæˆäº†æ¶æ§‹å‡ç´šçš„é‡è¦é‡Œç¨‹ç¢‘</strong></p>
                <p style="margin-top: 15px; font-size: 1.1em;">âœ¨ æ›´é«˜çš„é–‹ç™¼æ•ˆç‡ â€¢ ğŸ›¡ï¸ æ›´å¥½çš„éŒ¯èª¤è™•ç† â€¢ ğŸ”§ æ›´å®¹æ˜“ç¶­è­·çš„ç¨‹å¼ç¢¼</p>
            </div>
        </div>
    </div>

    <script>
        // ç°¡å–®çš„å°åˆ·æ¨£å¼å„ªåŒ–
        window.addEventListener('beforeprint', function () {
            document.body.style.background = 'white';
        });

        window.addEventListener('afterprint', function () {
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        });
    </script>
</body>

</html>